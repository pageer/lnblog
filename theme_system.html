<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en"><head>
  <title>LnBlog Theme System</title></head>
<body>
<h1>Understanding the LnBlog Theme System</h1>


<p>Copyright (C) 2005 Peter A. Geer &lt;<a href="mailto:pageer@skepticats.com">pageer@skepticats.com</a>&gt;<br />
Last update: 2005-Jun-30</p>


<p>This document describes the theme and template system used by LnBlog. It
is a custom theme system based in part on the template system described in the article
<a href="http://www.sitepoint.com/print/beyond-template-engine">Beyond the Template Engine</a>.&nbsp;
It includes images, style sheets, and client-side scripts for each
theme, as well as a path mechanism for determining which file to use.</p>


<h2>Overview</h2>


<p>The basic operation of the
LnBlog theme system is quite simle, although tracking how files
interact to form a final web page can be somewhat
complicated.&nbsp; The
general principle is that each page is made up of a series of embedded
templates with references to external images, scripts, and style
sheets.&nbsp; The exact files to use to build the page are
determined by a path search, where the first existent file found is the
one used.&nbsp; This allows us to create minimal themes, creating
and modifying only the files we want to change and letting the others
filter down to the defaults.&nbsp; It also allows users selectively
over-ride parts of a theme for an individual weblog without changing
the system-wide theme.&nbsp; <br />
</p>


<p>A separate template is
generally used for each part of the page.&nbsp; For instance, there
is a template for a blog entry, a template for a comment, one for the
sidebar, one for the main page layout, and so forth.&nbsp;
Sometimes the same template, populated with different data, is used
several times on the same page.&nbsp; The multiple blog entries on
the front page of a weblog is a good example of this.&nbsp; <br />
</p>


<h2>Template Mechanics</h2>


<p>The templates used by LnBlog
are simple PHP scripts.&nbsp; There's no special syntax or
processing engine - all the hard work is done by PHP itself.&nbsp;
The template class simply uses PHP's include() facility in conjunction
with variable extraction andoutput buffering to add data to the
template scripts and save the resulting text into a variable.&nbsp;
This variable can then be included into another template or written to
the browser.</p>


<p>This design implies that
templates are fully scriptable.&nbsp; You can add conditional
display, looping, variable formatting, and pretty much anything else
that you can do in PHP.&nbsp; Of course, it's usually best to keep
any complicated login in the
back-end code, but it's nice to have this kind of flexibility in case
you need it.&nbsp; <br />
</p>


<p>This also means that you need a working konwledge of PHP to modify some of the templates.&nbsp; However, as the <a href="http://www.sitepoint.com/print/beyond-template-engine">SitePoint article</a>
points out, PHP's syntax isn't significantly more complicated than that
of true template engines like Smarty.&nbsp; Simpler syntax might be
marginally easier for non-technical users, but if you don't do too much
fancy stuff in the templates, they should be able to figure out the
PHP.&nbsp; <br />
</p>


<p>One thing you might want to note about the default LnBlog themes is that they
output variables using the <code>&lt;?php&nbsp;echo&nbsp;$VARNAME;&nbsp;?&gt;</code>
syntax.&nbsp; This is a bit harder to read than the simple <code>&lt;?=$VARNAME?&gt;</code>,
but it does not require any partiuclar server configuration in order to
work, which is why it is used for the default themes. If your server is
configured to support short tags, you can certainly use them.</p>


<h2>Theme Structure</h2>


<p>A theme is simply a directory
with a particular layout.&nbsp; The directory should be named after
the theme and should contain four subdirectories: templates, scripts,
styles, and images.&nbsp; The contents of these directories should
be fairly obvious.&nbsp; They hold the PHP templates, any
client-side scripts (e.g. JavaScript files), style sheets, and any
images used by the theme.&nbsp; </p>


<h2>Resolving File Paths</h2>


In order to make themes somewhat fail-safe, LnBlog uses a path
mechanism to include files in a page.&nbsp; This is used to
over-ride files in a theme on a per-weblog basis, or to fall back to a
default file if one is missing from the current theme.&nbsp; In
fact, all themes other than the default are missing quite a few
files.&nbsp; They simply include copies of the files that differ
and let the theming system fall back to the defaults for the
rest.&nbsp; <br />


<p>LnBlog checks for files in the following order:</p>


<ol>


<li>Current weblog directory</li>
<li>Current theme directory</li>
<li>Default theme directory</li>
</ol>


<p>Note that it will check in the
same subdirectories as used in the theme directory layout.&nbsp;
So, for example, if you want to change an image for a particular
weblog, you would create an "images" directory and copy the new image
into it.&nbsp; Likewise, if you created a new theme and did not
want to change the appearance of blog entries from the default theme,
you would simply not create templates or style sheets for the blog entries in your theme.</p>


<p>Because templates are actually PHP files, LnBlog uses PHP's standard <code>include_path</code> configuration variable
to determine which file to use.&nbsp; However, for other types of
files, this will not work.&nbsp; Therefore, LnBlog includes a PHP
function called <code>getlink()</code>, which returns a URL to the selected file, suitable for
using as an <code>href</code> or <code>src</code> attribute in an HTML tag.&nbsp; <br />
</p>


<p>The <code>getlink()</code>
function takes as parameters the name of the desired file and an
optional constant for the type of the file.&nbsp; The valid type
constants, which determine which driectories to check for the file, are LINK_IMAGE, LINK_SCRIPT, and LINK_STYLESHEET.&nbsp;
If you do not specify a file type, then <code>getlink()</code> will try to guess the file type from the extension.&nbsp; For uncommon file extensions, this may very well fail.</p>


<h2>Examlpes</h2>


<h3>Adding an image to the banner for a single weblog<br />
</h3>


<p>Let's say you want to change the banner for just a single
weblog.&nbsp; Perhaps you want to add a picture to it.&nbsp; You can
easily add this without disturbing any other weblog managed by LnBlog.<br />
</p>


<p>To do this, you would go to the
root directory of the weblog and create three new directories:
templates, styles, and images.&nbsp;
You would then copy the include_banner.php file from your theme
template directory into the new templates directory, copy the banner.css file from the theme styles directory into the new
styles directory, and copy the desired image to the new images directory.&nbsp; If you have a UNIX
command prompt available, the commands would look something like this:<br />
<code>
mkdir myblog/templates<br />
mkdir myblog/styles<br />
mkdir myblog/images<br />
cp lnblog/themes/default/templates/include_banner.php myblog/templates/<br />
cp lnblog/themes/default/styles/banner.css myblog/styles/<br />
cp someimage.jpg myblog/images/<br />
</code></p>


<p>You would then modify the HTML in your copy of include_banner.php to add the image.&nbsp; You would use a line like this:<br />
<code>&lt;img src="&lt;?php echo getlink("someimages.jpg"); ?&gt;" alt="some image" /&gt;<br /></code>The
PHP block uses the getlink() utility function to auto-detect the path
to someimage.jpg so that you don't have to worry about the exact
URL.&nbsp; You can then modify the CSS file to suit your needs.&nbsp;
Note that if you don't want to change the CSS, you can just skip
copying the style sheet.</p>
<p><strong>Note:</strong> As of version 0.4.0, the banner, sidebar, and
menubar (or sitemap) are all implemented in plugins, so if you wanted
to change one of these, then the plugins would be the place to
start.&nbsp; However, there are still templates for these, although
they pretty much just raise plugin events.</p>

<h3>Creating a new theme</h3>
<p>Creating a system-wide theme in LnBlog is quite easy.&nbsp; If you
want to change substantial parts of any of the default themes, then
creating a new one is the recommended way to do it, as you won't have
to worry abou conflicts when you upgrade.</p>
<p>Creating a new theme is as easy as creating a new directory named for the theme in your LnBlog themes directory.&nbsp; If
you're creating an entirely new theme, then create four new directories
inside this: templates, styles, scripts, and images.&nbsp; If you're
creating a theme derived from another theme other than "default", say
"tuxice," then you need to make copies of all the files for this
theme.&nbsp; In that case, the easiest way is to just copy the entire
theme directory to a new name.</p>
<p>Now comes the hard part: identifying which files you want to
change.&nbsp; You're on your own for this.&nbsp; All you have to do is
make a file of the same name in the same location in your theme file
structure and put whatever you like in it.&nbsp; However, as a general
rule, you theme should not include copies of files that you don't
change from the default theme.&nbsp; If a particular file does not
exist in your theme directory, then LnBlog will try to use the one
included in the default theme, which makes it easier to include future bug fixes into your theme.&nbsp; <br />
</p>
<p>Once you've changed all the files you care to, you can modify your blog settings and choose your new theme from the list. <br />
</p>
<h2>Include Chains</h2>
<p>As previously mentioned, LnBlog uses a series of templates nested inside each other to build
a page.&nbsp; One consequence of this is that if you want to make any
significant changes to the layout of a page, you may need to change several files.&nbsp; The most important template files are probably the following:</p>
<ul>
  <li>article_tpl.php -&nbsp; Controls the display of articles.</li>
  <li>blogentry_tpl.php - Controls the display of blog entries.</li>
  <li>blogcomment_tpl.php - Controls the display of comments.</li>
  <li>trackback_tpl.php - Controls the display of TrackBack entries.</li>
</ul>
</body></html>